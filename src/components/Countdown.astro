---
import NumberCard from "./NumberCard.astro";
const { TIMESTAMP_END } = Astro.props;
---

<section
  data-date={TIMESTAMP_END}
  class="grid grid-cols-4 gap-2 max-w-3xl select-none hover:cursor-crosshair"
>
  <NumberCard>
    <span class="text-5xl font-bold" data-days>00</span>
    <span>D√çAS</span>
  </NumberCard>
  <NumberCard>
    <span class="text-5xl font-bold" data-hours>00</span>
    <span>HORAS</span>
  </NumberCard>
  <NumberCard>
    <span class="text-5xl font-bold" data-minutes>00</span>
    <span>MINUTOS</span>
  </NumberCard>
  <NumberCard>
    <span class="text-5xl font-bold" data-seconds>00</span>
    <span>SEGUNDOS</span>
  </NumberCard>
</section>
<section id="its-time"></section>

<script>
  const $ = (s: string) => document.querySelector(s);
  const SECONDS = 1000;
  const MINUTES = SECONDS * 60;
  const HOURS = MINUTES * 60;
  const DAYS = HOURS * 24;

  function init() {
    const $countdown = $("[data-date]");
    if (!$countdown) return;
    const $days = $countdown.querySelector("[data-days]");
    const $hours = $countdown.querySelector("[data-hours]");
    const $minutes = $countdown.querySelector("[data-minutes]");
    const $seconds = $countdown.querySelector("[data-seconds]");
    const timestamp = $countdown.getAttribute("data-date");
    if (!timestamp) return;
    const date = new Date(+timestamp).getTime();

    function formatTime(time: number) {
      return Math.floor(time).toString().padStart(2, "0");
    }

    function updateCountdown() {
      const now = Date.now();
      const distance = date - now;
      if (distance < 0) {
        if (!timestamp) return;
        const dateEnd = new Date(+timestamp);
        if (dateEnd.getDate() == new Date().getDate() && $countdown) {
          $countdown.className = "hidden";
          const $itsTime = $("#its-time");
          if ($itsTime instanceof HTMLElement) {
            $itsTime.innerHTML = `
            <div class="flex flex-col border-1 border-gray-400 p-4 gap-4 justify-center items-center  rounded">
            <h2 class="text-4xl text-[#D52941] font-bold text-center">üéÑ ¬°FELIZ NAVIDAD PARA TODOS! üéÑ</h2>
            <p class="text-center">¬°El gran d√≠a ha llegado! Que esta Navidad est√© llena de alegr√≠a, amor y momentos inolvidables junto a tus seres queridos.</p>
            </div>
            `;
          }
        }
      }
      if ($days instanceof HTMLElement) {
        $days.innerText = formatTime(distance / DAYS);
      }
      if ($hours instanceof HTMLElement) {
        $hours.innerText = formatTime((distance % DAYS) / HOURS);
      }
      if ($minutes instanceof HTMLElement) {
        $minutes.innerText = formatTime((distance % HOURS) / MINUTES);
      }
      if ($seconds instanceof HTMLElement) {
        $seconds.innerText = formatTime((distance % MINUTES) / SECONDS);
      }
    }

    setInterval(updateCountdown, 1000);
  }

  init();
</script>
